(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{487:function(v,_,o){"use strict";o.r(_);var t=o(1),e=Object(t.a)({},(function(){var v=this,_=v._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("p",[v._v("第一节讲了 TCP 三次握手，可能有人会说，每次都三次握手好麻烦呀！能不能优化一点？")]),v._v(" "),_("p",[v._v("可以啊。今天来说说这个优化后的 TCP 握手流程，也就是 TCP 快速打开(TCP Fast Open, 即TFO)的原理。")]),v._v(" "),_("p",[v._v("优化的过程是这样的，还记得我们说 SYN Flood 攻击时提到的 SYN Cookie 吗？这个 Cookie 可不是浏览器的"),_("code",[v._v("Cookie")]),v._v(", 用它同样可以实现 TFO。")]),v._v(" "),_("h2",{attrs:{id:"tfo-流程"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#tfo-流程"}},[v._v("#")]),v._v(" TFO 流程")]),v._v(" "),_("h3",{attrs:{id:"首轮三次握手"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#首轮三次握手"}},[v._v("#")]),v._v(" 首轮三次握手")]),v._v(" "),_("p",[v._v("首先客户端发送"),_("code",[v._v("SYN")]),v._v("给服务端，服务端接收到。")]),v._v(" "),_("p",[v._v("注意哦！现在服务端不是立刻回复 SYN + ACK，而是通过计算得到一个"),_("code",[v._v("SYN Cookie")]),v._v(", 将这个"),_("code",[v._v("Cookie")]),v._v("放到 TCP 报文的 "),_("code",[v._v("Fast Open")]),v._v("选项中，然后才给客户端返回。")]),v._v(" "),_("p",[v._v("客户端拿到这个 Cookie 的值缓存下来。后面正常完成三次握手。")]),v._v(" "),_("p",[v._v("首轮三次握手就是这样的流程。而后面的三次握手就不一样啦！")]),v._v(" "),_("h3",{attrs:{id:"后面的三次握手"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#后面的三次握手"}},[v._v("#")]),v._v(" 后面的三次握手")]),v._v(" "),_("p",[v._v("在后面的三次握手中，客户端会将之前缓存的 "),_("code",[v._v("Cookie")]),v._v("、"),_("code",[v._v("SYN")]),v._v(" 和"),_("code",[v._v("HTTP请求")]),v._v("(是的，你没看错)发送给服务端，服务端验证了 Cookie 的合法性，如果不合法直接丢弃；如果是合法的，那么就正常返回"),_("code",[v._v("SYN + ACK")]),v._v("。")]),v._v(" "),_("p",[v._v("重点来了，现在服务端能向客户端发 HTTP 响应了！这是最显著的改变，三次握手还没建立，仅仅验证了 Cookie 的合法性，就可以返回 HTTP 响应了。")]),v._v(" "),_("p",[v._v("当然，客户端的"),_("code",[v._v("ACK")]),v._v("还得正常传过来，不然怎么叫三次握手嘛。")]),v._v(" "),_("p",[v._v("流程如下:")]),v._v(" "),_("p",[_("img",{attrs:{src:v.$withBase("/tcp/007.jpg")}})]),v._v(" "),_("p",[v._v("注意: 客户端最后握手的 ACK 不一定要等到服务端的 HTTP 响应到达才发送，两个过程没有任何关系。")]),v._v(" "),_("h2",{attrs:{id:"tfo-的优势"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#tfo-的优势"}},[v._v("#")]),v._v(" TFO 的优势")]),v._v(" "),_("p",[v._v("TFO 的优势并不在与首轮三次握手，而在于后面的握手，在拿到客户端的 Cookie 并验证通过以后，可以直接返回 HTTP 响应，充分利用了"),_("strong",[v._v("1 个RTT")]),v._v("(Round-Trip Time，往返时延)的时间"),_("strong",[v._v("提前进行数据传输")]),v._v("，积累起来还是一个比较大的优势。")])])}),[],!1,null,null,null);_.default=e.exports}}]);