<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>016 TLS 1.3 做了哪些改进？</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.d419e9f5.css" as="style"><link rel="preload" href="/assets/js/app.597bc1ab.js" as="script"><link rel="preload" href="/assets/js/2.7f231572.js" as="script"><link rel="preload" href="/assets/js/81.52bc6286.js" as="script"><link rel="prefetch" href="/assets/js/10.cd7aef0e.js"><link rel="prefetch" href="/assets/js/100.ac640f1b.js"><link rel="prefetch" href="/assets/js/101.92b1a666.js"><link rel="prefetch" href="/assets/js/102.a5b6605c.js"><link rel="prefetch" href="/assets/js/11.737033a8.js"><link rel="prefetch" href="/assets/js/12.778e21e5.js"><link rel="prefetch" href="/assets/js/13.4458b60a.js"><link rel="prefetch" href="/assets/js/14.85430354.js"><link rel="prefetch" href="/assets/js/15.866abff7.js"><link rel="prefetch" href="/assets/js/16.18a94b0f.js"><link rel="prefetch" href="/assets/js/17.c8a906fe.js"><link rel="prefetch" href="/assets/js/18.c5f6e509.js"><link rel="prefetch" href="/assets/js/19.c052635a.js"><link rel="prefetch" href="/assets/js/20.b8666fc4.js"><link rel="prefetch" href="/assets/js/21.63a49891.js"><link rel="prefetch" href="/assets/js/22.ef5b75ef.js"><link rel="prefetch" href="/assets/js/23.2c9b98da.js"><link rel="prefetch" href="/assets/js/24.15ee7b76.js"><link rel="prefetch" href="/assets/js/25.38f56a57.js"><link rel="prefetch" href="/assets/js/26.7642b727.js"><link rel="prefetch" href="/assets/js/27.98ea391d.js"><link rel="prefetch" href="/assets/js/28.a5388fd8.js"><link rel="prefetch" href="/assets/js/29.e00a3183.js"><link rel="prefetch" href="/assets/js/3.52f64968.js"><link rel="prefetch" href="/assets/js/30.320159a6.js"><link rel="prefetch" href="/assets/js/31.a98fccc1.js"><link rel="prefetch" href="/assets/js/32.98f4c2b5.js"><link rel="prefetch" href="/assets/js/33.b02d8821.js"><link rel="prefetch" href="/assets/js/34.419e68c3.js"><link rel="prefetch" href="/assets/js/35.05ed10ef.js"><link rel="prefetch" href="/assets/js/36.53cf93d4.js"><link rel="prefetch" href="/assets/js/37.a721f6b0.js"><link rel="prefetch" href="/assets/js/38.a6de7825.js"><link rel="prefetch" href="/assets/js/39.1ac1a8cc.js"><link rel="prefetch" href="/assets/js/4.48b4422a.js"><link rel="prefetch" href="/assets/js/40.12fe2f4d.js"><link rel="prefetch" href="/assets/js/41.4ad53b16.js"><link rel="prefetch" href="/assets/js/42.5f2ac15b.js"><link rel="prefetch" href="/assets/js/43.0c157d58.js"><link rel="prefetch" href="/assets/js/44.278025b5.js"><link rel="prefetch" href="/assets/js/45.681f6262.js"><link rel="prefetch" href="/assets/js/46.1fe02762.js"><link rel="prefetch" href="/assets/js/47.5b862402.js"><link rel="prefetch" href="/assets/js/48.e4ba99f5.js"><link rel="prefetch" href="/assets/js/49.a416c2c0.js"><link rel="prefetch" href="/assets/js/5.9fb5b5b0.js"><link rel="prefetch" href="/assets/js/50.44e7d05c.js"><link rel="prefetch" href="/assets/js/51.80fede48.js"><link rel="prefetch" href="/assets/js/52.d36acb57.js"><link rel="prefetch" href="/assets/js/53.da8140cf.js"><link rel="prefetch" href="/assets/js/54.3d2df001.js"><link rel="prefetch" href="/assets/js/55.08fb8dd3.js"><link rel="prefetch" href="/assets/js/56.4fa61c15.js"><link rel="prefetch" href="/assets/js/57.a4ffdf09.js"><link rel="prefetch" href="/assets/js/58.ddc39213.js"><link rel="prefetch" href="/assets/js/59.9708ff07.js"><link rel="prefetch" href="/assets/js/6.a45e2ad6.js"><link rel="prefetch" href="/assets/js/60.119bb60a.js"><link rel="prefetch" href="/assets/js/61.0e4c6284.js"><link rel="prefetch" href="/assets/js/62.85c62cf2.js"><link rel="prefetch" href="/assets/js/63.5dc728ff.js"><link rel="prefetch" href="/assets/js/64.c80f64a7.js"><link rel="prefetch" href="/assets/js/65.ec99bbae.js"><link rel="prefetch" href="/assets/js/66.2662bea1.js"><link rel="prefetch" href="/assets/js/67.ea4edc14.js"><link rel="prefetch" href="/assets/js/68.02627936.js"><link rel="prefetch" href="/assets/js/69.8076802f.js"><link rel="prefetch" href="/assets/js/7.d35dd535.js"><link rel="prefetch" href="/assets/js/70.8234d4d6.js"><link rel="prefetch" href="/assets/js/71.82e24372.js"><link rel="prefetch" href="/assets/js/72.423bb3b6.js"><link rel="prefetch" href="/assets/js/73.1f98ee7b.js"><link rel="prefetch" href="/assets/js/74.4de48986.js"><link rel="prefetch" href="/assets/js/75.1bfccbb6.js"><link rel="prefetch" href="/assets/js/76.9ceb332a.js"><link rel="prefetch" href="/assets/js/77.fb37f08b.js"><link rel="prefetch" href="/assets/js/78.d603564d.js"><link rel="prefetch" href="/assets/js/79.7d237ad6.js"><link rel="prefetch" href="/assets/js/8.f742d5fb.js"><link rel="prefetch" href="/assets/js/80.d802fbd5.js"><link rel="prefetch" href="/assets/js/82.b9ab6b75.js"><link rel="prefetch" href="/assets/js/83.797d040a.js"><link rel="prefetch" href="/assets/js/84.59080c2f.js"><link rel="prefetch" href="/assets/js/85.7f135122.js"><link rel="prefetch" href="/assets/js/86.78355378.js"><link rel="prefetch" href="/assets/js/87.59884bf2.js"><link rel="prefetch" href="/assets/js/88.f4629246.js"><link rel="prefetch" href="/assets/js/89.859ece07.js"><link rel="prefetch" href="/assets/js/9.bd6fb225.js"><link rel="prefetch" href="/assets/js/90.3460e42a.js"><link rel="prefetch" href="/assets/js/91.92d4ec8a.js"><link rel="prefetch" href="/assets/js/92.5558c035.js"><link rel="prefetch" href="/assets/js/93.4aed378f.js"><link rel="prefetch" href="/assets/js/94.d1f0856b.js"><link rel="prefetch" href="/assets/js/95.7b7c6344.js"><link rel="prefetch" href="/assets/js/96.0529376d.js"><link rel="prefetch" href="/assets/js/97.5b99c6f7.js"><link rel="prefetch" href="/assets/js/98.886f3441.js"><link rel="prefetch" href="/assets/js/99.6160cdca.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d419e9f5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>016 TLS 1.3 做了哪些改进？</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blogs/net/http/016.html#强化安全" class="sidebar-link">强化安全</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blogs/net/http/016.html#提升性能" class="sidebar-link">提升性能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blogs/net/http/016.html#握手改进" class="sidebar-link">握手改进</a></li><li class="sidebar-sub-header"><a href="/blogs/net/http/016.html#会话复用" class="sidebar-link">会话复用</a></li><li class="sidebar-sub-header"><a href="/blogs/net/http/016.html#psk" class="sidebar-link">PSK</a></li></ul></li><li><a href="/blogs/net/http/016.html#总结" class="sidebar-link">总结</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>TLS 1.2 虽然存在了 10 多年，经历了无数的考验，但历史的车轮总是不断向前的，为了获得更强的安全、更优秀的性能，在<code>2018年</code>就推出了 TLS1.3，对于<code>TLS1.2</code>做了一系列的改进，主要分为这几个部分:<strong>强化安全</strong>、<strong>提高性能</strong>。</p> <h2 id="强化安全"><a href="#强化安全" class="header-anchor">#</a> 强化安全</h2> <p>在 TLS1.3 中废除了非常多的加密算法，最后只保留五个加密套件:</p> <ul><li>TLS_AES_128_GCM_SHA256</li> <li>TLS_AES_256_GCM_SHA384</li> <li>TLS_CHACHA20_POLY1305_SHA256</li> <li>TLS_AES_128_GCM_SHA256</li> <li>TLS_AES_128_GCM_8_SHA256</li></ul> <p>可以看到，最后剩下的对称加密算法只有 <strong>AES</strong> 和 <strong>CHACHA20</strong>，之前主流的也会这两种。分组模式也只剩下 <strong>GCM</strong> 和 <strong>POLY1305</strong>, 哈希摘要算法只剩下了 <strong>SHA256</strong> 和 <strong>SHA384</strong> 了。</p> <p>那你可能会问了, 之前<code>RSA</code>这么重要的非对称加密算法怎么不在了？</p> <p>我觉得有两方面的原因:</p> <p><strong>第一</strong>、2015年发现了<code>FREAK</code>攻击，即已经有人发现了 RSA 的漏洞，能够进行破解了。</p> <p><strong>第二</strong>、一旦私钥泄露，那么中间人可以通过私钥计算出之前所有报文的<code>secret</code>，破解之前所有的密文。</p> <p>为什么？回到 RSA 握手的过程中，客户端拿到服务器的证书后，提取出服务器的公钥，然后生成<code>pre_random</code>并用<strong>公钥</strong>加密传给服务器，服务器通过<strong>私钥</strong>解密，从而拿到真实的<code>pre_random</code>。当中间人拿到了服务器私钥，并且截获之前所有报文的时候，那么就能拿到<code>pre_random</code>、<code>server_random</code>和<code>client_random</code>并根据对应的随机数函数生成<code>secret</code>，也就是拿到了 TLS 最终的会话密钥，每一个历史报文都能通过这样的方式进行破解。</p> <p>但<code>ECDHE</code>在每次握手时都会生成临时的密钥对，即使私钥被破解，之前的历史消息并不会收到影响。这种一次破解并不影响历史信息的性质也叫<strong>前向安全性</strong>。</p> <p><code>RSA</code> 算法不具备前向安全性，而 <code>ECDHE</code> 具备，因此在 TLS1.3 中彻底取代了<code>RSA</code>。</p> <h2 id="提升性能"><a href="#提升性能" class="header-anchor">#</a> 提升性能</h2> <h3 id="握手改进"><a href="#握手改进" class="header-anchor">#</a> 握手改进</h3> <p>流程如下:
<img src="/http/011.jpg"></p> <p>大体的方式和 TLS1.2 差不多，不过和 TLS 1.2 相比少了一个 RTT， 服务端不必等待对方验证证书之后才拿到<code>client_params</code>，而是直接在第一次握手的时候就能够拿到, 拿到之后立即计算<code>secret</code>，节省了之前不必要的等待时间。同时，这也意味着在第一次握手的时候客户端需要传送更多的信息，一口气给传完。</p> <p>这种 TLS 1.3 握手方式也被叫做<strong>1-RTT握手</strong>。但其实这种<code>1-RTT</code>的握手方式还是有一些优化的空间的，接下来我们来一一介绍这些优化方式。</p> <h3 id="会话复用"><a href="#会话复用" class="header-anchor">#</a> 会话复用</h3> <p>会话复用有两种方式: <strong>Session ID</strong>和<strong>Session Ticket</strong>。</p> <p>先说说最早出现的<strong>Seesion ID</strong>，具体做法是客户端和服务器首次连接后各自保存会话的 ID，并存储会话密钥，当再次连接时，客户端发送<code>ID</code>过来，服务器查找这个 ID 是否存在，如果找到了就直接复用之前的会话状态，会话密钥不用重新生成，直接用原来的那份。</p> <p>但这种方式也存在一个弊端，就是当客户端数量庞大的时候，对服务端的存储压力非常大。</p> <p>因而出现了第二种方式——<strong>Session Ticket</strong>。它的思路就是: 服务端的压力大，那就把压力分摊给客户端呗。具体来说，双方连接成功后，服务器加密会话信息，用<strong>Session Ticket</strong>消息发给客户端，让客户端保存下来。下次重连的时候，就把这个 Ticket 进行解密，验证它过没过期，如果没过期那就直接恢复之前的会话状态。</p> <p>这种方式虽然减小了服务端的存储压力，但与带来了安全问题，即每次用一个固定的密钥来解密 Ticket 数据，一旦黑客拿到这个密钥，之前所有的历史记录也被破解了。因此为了尽量避免这样的问题，密钥需要定期进行更换。</p> <p>总的来说，这些会话复用的技术在保证<code>1-RTT</code>的同时，也节省了生成会话密钥这些算法所消耗的时间，是一笔可观的性能提升。</p> <h3 id="psk"><a href="#psk" class="header-anchor">#</a> PSK</h3> <p>刚刚说的都是<code>1-RTT</code>情况下的优化，那能不能优化到<code>0-RTT</code>呢？</p> <p>答案是可以的。做法其实也很简单，在发送<strong>Session Ticket</strong>的同时带上应用数据，不用等到服务端确认，这种方式被称为<code>Pre-Shared Key</code>，即 PSK。</p> <p>这种方式虽然方便，但也带来了安全问题。中间人截获<code>PSK</code>的数据，不断向服务器重复发，类似于 TCP 第一次握手携带数据，增加了服务器被攻击的风险。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>TLS1.3 在 TLS1.2 的基础上废除了大量的算法，提升了安全性。同时利用会话复用节省了重新生成密钥的时间，利用 PSK 做到了<code>0-RTT</code>连接。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.597bc1ab.js" defer></script><script src="/assets/js/2.7f231572.js" defer></script><script src="/assets/js/81.52bc6286.js" defer></script>
  </body>
</html>
